# 一起学习Scheme 初步

有一个上古语言,它叫Lisp,网上关于Lisp的介绍的文章还是不少的,我就不在这里说了.

Lisp是有一个方言的概念的,各种各样的方言.

当然Lisp早在好久之前就已经死了,现在只是一堆方言罢了.

目前最流行的两个方言是: common lisp和Scheme, 当然其他的方言比如Cojure, quick lisp, vlisp等等.


## 鼓吹一下Lisp(Scheme)

引用一下R5RS开篇第一段话:

> 程序设计语言的设计不应该是特征的堆砌，而应消除那些需要依赖于多余特征的弱点和局限。 Scheme语言证明，极少的表达式构造规则和不加限制的表达式复合方式可以构造出实用而高效的程序设计语言， 其灵活性足以支持今天的大部分主流编程模型。

> Scheme是最早的像在lambda演算里一样提供了第一级过程的程序设计语言之一， 并由此在动态类型的语言中提供了有用的静态作用域规则和块结构的特征。 在Lisp的主要方言中，Scheme第一次使过程有别于lambda表达式和符号， 为所有变量使用单一的词法环境，在确定运算符的位置时采用与确定运算对象位置一样的方式。 Scheme完全依赖过程调用来表示迭代，并以此强调，尾递归过程调用在本质上就是传递参数的goto。 Scheme是第一种被广泛使用的，采纳第一级逃逸过程（escape procedure）的程序设计语言， 通过第一级逃逸过程可以合成所有已知的顺序控制结构。 Scheme的后续版本引入了精确和非精确数的概念，这是CommonLisp语言通用算术功能的扩展。 最近，Scheme成为了第一种支持卫生宏（hygienic macro）的程序设计语言， 该机制允许我们以一种一致和可靠的方式扩展块结构语言的语法。


说点我自己的感受,我通过SICP(《计算机程序的设计和解释》)这本书认识的Scheme,
然后深深的迷恋上了这本书,并且如坑Scheme,竟然坚信Scheme是世界上最好的语言.

Scheme很酷,但是在实际中可能没啥用处.

Scheme(它是一个函数式语言)中很多东西很难用, 比如变量赋值,需要你调用一个函数才能赋值,而不是像其他语言那样用一个等号, 其他语言在一个for循环中,如果想跳出循环,那么写个break就好了,
不过Scheme去需要call/cc这样的高难度的技巧才可以做到.

比如其他语言定义一个变量并初始化:

```C
int foo = 10;
```

Scheme是:
```Schem
(define foo 10)
```

或者
```Scheme
(let ((foo 10)) (TODO))
```

Scheme可以说是Lisp中最简单的了,语法规则少,内容少,官方文档只有几十页, common lisp内容就多的不像话了.

虽然语法规则很好,但是很难运用灵活,我学了半年多了,自己写出来的程序还是很"垃圾".

当然,忘记是从那里看到的(可能是黑客与画家这本书),黑客很喜欢Lisp.

对于Scheme的学习,我会坚持下去.
我对外人的解释是:屠龙之技,岂是人人都能掌握的.
当然学习Lisp会有加分的,这么坑爹的东西你都花时间学了,证明你有一定的自学能力.
反正在我找工作的时候给我加分了.

## 环境怎么搭建:

我介绍两种:

第一是Drracket,这是一个集成开发环境,Scheme有一个方言,叫racket,他们为racket开发的IDE.

可以去他们的 [官网下载](https://download.racket-lang.org/)

Linux用户也可以用命令行安装(希望我们记错,不过命令行安装的话,你最好百度):

> sudo apt-get install racket

![racket示例图片](http://img.vim-cn.com/48/455d12e721566a8c711b9c2a24989f72145be5.png)

在语言选择那里,选择R5RS.你目前不懂,没关系,慢慢你会懂得.右上角有运行按钮,点击运行就可以了.

另一个是一个编辑器: [Chez Scheme](https://github.com/cisco/ChezScheme) (最好你是*nix系统).

你知道它很厉害就可以了,编译出来的程序速度可以媲美C的速度.

这个编译器已经在开源github了,过去可是闭源付费的,我具体没在Windows上安装过,我自己是Linux系统.
当时是安装是这样的,去github上下载了源代码,按照README上的说明,编译安装的.

我用的编辑器是Atom(不要跟我说什么EMACS,不会emacs的人,没必要再花时间去学习如何使用,简单点最好).顺便提一句,vs code对Lisp的支持不好.

你需要下载两个两个插件: language-scheme (用来提供语法高亮) 和 script (用来一键运行程序,说一下这个插件, 这个支持的语言还是不少的)(运行的快捷键是: ctrl + shift + b)

程序的第一行要写上Unix的shebang,如果没写是什么效果:

![未添加shebang效果](http://img.vim-cn.com/02/9cfb42c55c0c53d8da07e5c935d6a16a9529c6.png)

它会显示无法运行.

加上shebang之后:

![加上shebang效果](http://img.vim-cn.com/24/f164d6226ab8ef8549b94b18eb6a3500d296c2.png)

这里你也可以看到我告诉了你shebang(shebang要写在文件第一行)怎么去写(怎么获得),
其实shebang就是告诉计算机,运行这个文件的程序在哪.


### Hello world
```Scheme
(display "Hello world") (newline)

(write "Hello world") (newline)

(printf "Hello world\n")
```

这里有三种在屏幕打印hello world的方式,

- 一般我们用display比较多.
- write一般是写在文件里面.比如C语言,向文件写内容可以是: fprintf(fp, format, ...),其实printf这个函数是调用的fprintf:fprintf(stdout, format, ...) write的完整是: (write "content" port) 这里的port其实就是那个文件,如果port不给的话,就打印到标准输出流.

- printf,就是格式化打印了,这里就不多解释了.

(newline) 是换行函数, display 和 write 是默认不换行的.


说明一下Scheme语法,它是一个括号很多的语言,所有的代码都写在括号里面,
也就是s-expression,因为Lisp有个东西叫宏,所以才会有S表达式之内无所不能.
你可以很轻松的用几十行代码把C语言表达出来.

它使用的是前缀表达式,这可能会让很多人一开始不适应,但是使用前缀表达式是正确的.

举个例子: 1 + 2 + 3, 在scheme是这样的:

> (+ 1 2 3)

加号在最前面,这个做法是对的,因为Scheme把这个 + 也当作一个 procedure(其他的语言叫函数,或者方法,在Lisp世界,我们叫过程). 这就将算数运算(比如四则运算)和函数相统一.

数学里的函数: f(x, y), 注意看函数f在最前面,而不是x f() y 这样类似的形式.
人们可以适应f(x, y)这样的写法,为什么不能接受+(1 2),进而为什么不能接受(+ 1 2)呢.

所以采用前缀表达式这是明智的,是统一. 当然这也有利于栈式计算机运算.

未来如果你坚持写Scheme,你的程序中会有大量的括号的存在,括号绝对不是一个问题,
格式化代码,括号对齐,你会慢慢感受到这个语言的美感.

这是最美的语言了,甚至优于数学表达式(我自己认为的).
